<!DOCTYPE html>
<html lang="tr">
<head>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BilimselMutfak">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#e67e22">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>BilimselMutfak ‚Äì Etli Yƒ±lan</title>
    <style>
        body {
            margin: 0;
            background: #ffe9d6;
            font-family: Arial,Helvetica,sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #4a2c16;
        }

        #gameWrap {
            position: relative
        }

        canvas {
            background: #fff4e6;
            border: 3px solid #e67e22;
            border-radius: 12px;
            touch-action: none;
        }

        #hud {
            margin: 6px;
            font-size: 16px;
            font-weight: bold
        }

        #message {
            height: 24px;
            color: #d35400;
            margin-bottom: 4px
        }

        /* Kontroller */
        #controls {
            display: grid;
            grid-template-columns: 60px 60px 60px;
            grid-template-rows: 60px 60px;
            gap: 8px;
            margin: 10px
        }

        .btn {
            background: #f39c12;
            color: #fff;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            user-select: none
        }

        #actions {
            display: flex;
            gap: 12px;
            margin-bottom: 10px
        }

        .actionBtn {
            background: #e67e22;
            color: #fff;
            padding: 8px 14px;
            border-radius: 12px;
            font-size: 14px
        }

        footer {
            width: 100%;
            text-align: center;
            padding: 8px 0;
            background: #e67e22;
            color: #fff;
            font-size: 13px
        }

        /* Ba≈ülangƒ±√ß overlay */
        #startOverlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-50%);
            background: rgba(255,244,230,0.96);
            border: 3px solid #e67e22;
            border-radius: 18px;
            padding: 20px 24px;
            text-align: center;
        }

            #startOverlay h2 {
                margin: 0 0 14px;
                color: #d35400
            }

        #levels {
            display: flex;
            gap: 12px;
            justify-content: center
        }

        .levelBtn {
            background: #f39c12;
            color: #fff;
            padding: 14px 18px;
            border-radius: 16px;
            font-size: 16px
        }

            .levelBtn span {
                display: block;
                font-size: 12px;
                opacity: .9
            }
    </style>
</head>
<body>
    <div id="hud">Puan: <span id="score">0</span> | Hak: <span id="lives">3</span></div>
    <div id="message"></div>

    <div id="gameWrap">
        <canvas id="game" width="360" height="520"></canvas>

        <!-- BA≈ûLANGI√á SE√áƒ∞Mƒ∞ (OYUN ALANI ORTASI) -->
        <div id="startOverlay">
            <h2>Etleri Topla<br />Rekora Ko≈ü üèÜ</h2>
            <div id="levels">
                <div class="levelBtn" data-speed="220">Kolay<span>Yava≈ü</span></div>
                <div class="levelBtn" data-speed="150">Orta<span>Normal</span></div>
                <div class="levelBtn" data-speed="90">Zor<span>Hƒ±zlƒ±</span></div>
            </div>
        </div>
    </div>

    <div id="controls">
        <div></div><div class="btn" data-dir="UP">‚¨ÜÔ∏è</div><div></div>
        <div class="btn" data-dir="LEFT">‚¨ÖÔ∏è</div><div class="btn" data-dir="DOWN">‚¨áÔ∏è</div><div class="btn" data-dir="RIGHT">‚û°Ô∏è</div>
    </div>

    <div id="actions">
        <div class="actionBtn" id="restart">üîÅ Yeniden Oyna</div>
        <div class="actionBtn" id="share">üì§ Arkada≈üƒ±na G√∂nder</div>
    </div>

    <footer>BilimselMutfak YouTube</footer>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const box = 24;
        const cols = Math.floor(canvas.width / box);
        const rows = Math.floor(canvas.height / box);

        let snake = [], dir = 'RIGHT', food = null, score = 0, lives = 3;
        let speed = 150, timer = null, waiting = false, gameOver = false, started = false;

        const scoreEl = document.getElementById('score');
        const livesEl = document.getElementById('lives');
        const msgEl = document.getElementById('message');

        function vibrate() { if (navigator.vibrate) navigator.vibrate(30); }

        function meatIcon(type) {
            const c = document.createElement('canvas'); c.width = 64; c.height = 64;
            const g = c.getContext('2d'); g.translate(32, 32);
            if (type === 'BONFƒ∞LE') { g.fillStyle = '#c0392b'; g.beginPath(); g.ellipse(0, 0, 26, 14, 0, 0, Math.PI * 2); g.fill(); }
            if (type === 'ANTRƒ∞KOT') { g.fillStyle = '#a93226'; g.beginPath(); g.arc(0, 0, 22, 0, Math.PI * 2); g.fill(); g.strokeStyle = '#fad7a0'; g.lineWidth = 4; g.beginPath(); g.arc(0, 0, 12, 0, Math.PI * 2); g.stroke(); }
            if (type === 'BUT') { g.fillStyle = '#d35400'; g.beginPath(); g.moveTo(-10, -20); g.quadraticCurveTo(22, 0, -6, 22); g.closePath(); g.fill(); }
            if (type === 'KABURGA') { g.fillStyle = '#922b21'; g.fillRect(-22, -10, 44, 20); g.strokeStyle = '#fdfefe'; g.lineWidth = 3; for (let i = -14; i <= 14; i += 14) { g.beginPath(); g.moveTo(i, -12); g.lineTo(i, 12); g.stroke(); } }
            if (type === 'ƒ∞NCƒ∞K') { g.fillStyle = '#b03a2e'; g.beginPath(); g.ellipse(0, 6, 14, 18, 0, 0, Math.PI * 2); g.fill(); }
            if (type === 'KANAT') { g.fillStyle = '#e67e22'; g.beginPath(); g.moveTo(-22, 0); g.quadraticCurveTo(0, -18, 22, 0); g.quadraticCurveTo(0, 10, -22, 0); g.fill(); }
            const img = new Image(); img.src = c.toDataURL(); return img;
        }

        const meats = [
            { name: 'BONFƒ∞LE', img: meatIcon('BONFƒ∞LE') },
            { name: 'ANTRƒ∞KOT', img: meatIcon('ANTRƒ∞KOT') },
            { name: 'BUT', img: meatIcon('BUT') },
            { name: 'KABURGA', img: meatIcon('KABURGA') },
            { name: 'ƒ∞NCƒ∞K', img: meatIcon('ƒ∞NCƒ∞K') },
            { name: 'KANAT', img: meatIcon('KANAT') }
        ];

        function spawnFood() {
            const m = meats[Math.floor(Math.random() * meats.length)];
            food = { x: Math.floor(Math.random() * cols), y: Math.floor(Math.random() * rows), meat: m };
        }

        function init() {
            snake = [{ x: 6, y: 10 }]; dir = 'RIGHT'; score = 0; lives = 3; waiting = false; gameOver = false;
            spawnFood(); updateUI(); clearInterval(timer);
            timer = setInterval(loop, speed);
        }

        function startGame(selSpeed) {
            speed = selSpeed; started = true;
            document.getElementById('startOverlay').style.display = 'none';
            init();
        }

        function updateUI() { scoreEl.textContent = score; livesEl.textContent = lives; }
        function message(t) { msgEl.textContent = t; setTimeout(() => msgEl.textContent = '', 2500); }

        function loop() { if (started && !waiting && !gameOver) step(); draw(); }

        function step() {
            const h = { ...snake[0] };
            if (dir === 'LEFT') h.x--; if (dir === 'RIGHT') h.x++; if (dir === 'UP') h.y--; if (dir === 'DOWN') h.y++;

            if (h.x < 0 || h.y < 0 || h.x >= cols || h.y >= rows || snake.some(p => p.x === h.x && p.y === h.y)) {
                lives--; updateUI(); waiting = true;
                if (lives <= 0) gameOver = true;
                return;
            }

            if (h.x === food.x && h.y === food.y) { score += 10; updateUI(); message('Et de lezzetliymi≈ü! (' + food.meat.name + ')'); vibrate(); spawnFood(); }
            else snake.pop();

            snake.unshift(h);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            snake.forEach((p, i) => { ctx.fillStyle = i ? '#f39c12' : '#e67e22'; ctx.fillRect(p.x * box, p.y * box, box, box); });
            if (food) ctx.drawImage(food.meat.img, food.x * box, food.y * box, box, box);
            if (gameOver) { ctx.fillStyle = 'rgba(0,0,0,0.6)'; ctx.fillRect(0, 0, canvas.width, canvas.height); ctx.fillStyle = '#fff'; ctx.font = '20px Arial'; ctx.textAlign = 'center'; ctx.fillText('BilimselMutfak YouTube', canvas.width / 2, canvas.height / 2); }
        }

        window.addEventListener('keydown', e => {
            if (e.key === 'Enter' && waiting && !gameOver) { waiting = false; spawnFood(); }
            if (e.key === 'ArrowLeft' && dir !== 'RIGHT') dir = 'LEFT';
            if (e.key === 'ArrowRight' && dir !== 'LEFT') dir = 'RIGHT';
            if (e.key === 'ArrowUp' && dir !== 'DOWN') dir = 'UP';
            if (e.key === 'ArrowDown' && dir !== 'UP') dir = 'DOWN';
        });

        // Mevcut mobil buton kontrolleri
        document.querySelectorAll('.btn').forEach(b => b.addEventListener('touchstart', () => {
            const d = b.dataset.dir;
            if (d === 'LEFT' && dir !== 'RIGHT') dir = 'LEFT';
            if (d === 'RIGHT' && dir !== 'LEFT') dir = 'RIGHT';
            if (d === 'UP' && dir !== 'DOWN') dir = 'UP';
            if (d === 'DOWN' && dir !== 'UP') dir = 'DOWN';
        }));

        // Canvas dokunma ile y√∂n kontrol√º (telefon ekranƒ± i√ßin)
        canvas.addEventListener('touchstart', function(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            if (x > centerX && Math.abs(x - centerX) > Math.abs(y - centerY)) {
                if (dir !== 'LEFT') dir = 'RIGHT';
            } else if (x < centerX && Math.abs(x - centerX) > Math.abs(y - centerY)) {
                if (dir !== 'RIGHT') dir = 'LEFT';
            } else if (y > centerY && Math.abs(y - centerY) > Math.abs(x - centerX)) {
                if (dir !== 'UP') dir = 'DOWN';
            } else if (y < centerY && Math.abs(y - centerY) > Math.abs(x - centerX)) {
                if (dir !== 'DOWN') dir = 'UP';
            }
        }, {passive: false});

        document.querySelectorAll('.levelBtn').forEach(b => {
            b.onclick = () => startGame(parseInt(b.dataset.speed));
        });

        document.getElementById('restart').onclick = () => location.reload();
        document.getElementById('share').onclick = () => {
            const url = location.href;
            if (navigator.share) navigator.share({ title: 'BilimselMutfak Etli Yƒ±lan', text: 'Et toplayarak b√ºy√ºyen eƒülenceli oyun!', url });
            else { navigator.clipboard.writeText(url); alert('Link kopyalandƒ±'); }
        };

        // ƒ∞lk √ßizim
        spawnFood(); draw();
    </script>
    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("service-worker.js");
        }
    </script>

</body>
</html>
